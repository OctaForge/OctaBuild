CXX = (getenv CXX c++)

OB_CXXFLAGS = "-g -Wall -Wextra -O2"

CUBESCRIPT_PATH = "../libcubescript"
OCTASTD_PATH = "../octastd"

FILES = [main.o globs.o cubescript.o]

OB_CXXFLAGS = [@OB_CXXFLAGS -std=c++11 -I. -I@CUBESCRIPT_PATH -I@OCTASTD_PATH -pthread]

rule obuild $FILES [
    echo "  LD" $target
    shell $CXX $OB_CXXFLAGS -o obuild $sources
]

rule cubescript.o [@CUBESCRIPT_PATH/cubescript.cc] [
    echo " CXX" $target
    shell $CXX $OB_CXXFLAGS -c -o $target $source
]

rule %.o %.cc [
    echo " CXX" $target
    shell $CXX $OB_CXXFLAGS -c -o $target $source
]

action clean [
    echo " CLEAN" $FILES obuild
    shell rm -f $FILES obuild
]

depend main.o globs.hh tpool.hh [@CUBESCRIPT_PATH/cubescript.hh]
depend globs.o globs.hh [@CUBESCRIPT_PATH/cubescript.hh]
depend cubescript.o [@CUBESCRIPT_PATH/cubescript.hh]

rule default obuild